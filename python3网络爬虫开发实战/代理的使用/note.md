# 代理池的维护
- 在网上有大量公开的免费代理,或者也可以购买付费的代理IP,但是代理不论是免费的还是付费的,都不能保证都是可用的
- 因为可能次IP被其他人使用来爬去同样的目标站点被封禁,或者代理服务器突然发生故障或网络繁忙
- 一旦我们选用了一个不可用的代理,这势必会影响爬虫的工作效率
- 所以需要提前做筛选,保留可用代理
- 准备工作
    - 需要提前安装Redis数据库并启动服务,例外还需要安装aiohttp, requests, redis-py, puqyery,Flas库
- 代理池的目标
    - 存储模块
        - 负责存储抓下来的代理.首先要保证代理不重复,要标示代理的可用情况,还有动态实时处理里每个代理
        - 所以一种比较高效和方便的存储方式就是使用Redis的SortedSet,及有序集合
    - 获取模块
        - 需要定时在各大代理网站抓取代理,代理可以是免费公开代理也可以是付费代理,代理的形式都是IP端口
        - 此模块尽量从不同来源获取,尽量抓取高匿代理,抓取成功之后可用代理保存导数据库中
    - 检测代理
        - 需要定时检测数据库中的代理,这里需要设置一个检测链接.最好是爬取那个网站就检测那个网站,这样更加有针对性
        - 如果要做一个通用型的代理,那可以设置百度等链接来检测,另外,我们需要标示每一个代理的状态,如设置分数标示,100分代表可用
        - 分数越少代表越不可用,检测一次,如果代理可用,我们可以讲分数标示设置为100满分,也可以在原基础上加1分
        - 如果代理不可用,可以将分数标示减一分,当分数见到一定阀值后,代理就直接从数据库移除
        - 通过这样的的标示分数,我们就可以辨别代理的可用情况,选用的时候会更有针对性
    - 接口模块
        - 需要用API来提供对外服务的接口,糗事可以直接链接数据库来去对应的数据,但是这样就需要知道数据库的链接信息
        - 并且要配置链接,而比较安全和方便的方式就是提供一个Web API接口,我们通过访问接口即可拿到可用代理
        - 另外,由于可用代理可能有多个,那么我们可以设置一个随机返回某个可用代理的接口,这样就能保证每个可用代理都可以取到,实现负载均衡
- 代理池的架构
        - 存储模块使用Redis的有序集合,用来做代理的去重和状态标识,同时她也是中心模块和基础模块,将其他模块串联起来
        - 获取模块定时从代理网站获取代理,将获取的代理传递给存储模块,并保存到数据库
        - 检测模块定时通过存储模块获取所有代理,并对代理进行检测,根据不同的检测结果对代理设置不同的标识
        - 接口模块通过Web API提供服务接口,接口通过连接数据库并通过Web形式返回可用的代理
- 
    